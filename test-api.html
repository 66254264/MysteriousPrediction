<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        button:hover {
            background: #0b7dda;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .status {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            margin: 5px 0;
        }
        .success { background: #4CAF50; color: white; }
        .error { background: #f44336; color: white; }
        .pending { background: #FFC107; color: black; }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            max-height: 400px;
        }
        .input-group {
            margin: 10px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input, .input-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <h1>🧪 API功能测试</h1>
    
    <div class="test-box">
        <h2>1. 健康检查</h2>
        <button onclick="testHealth()">测试健康检查</button>
        <div id="health-result"></div>
    </div>

    <div class="test-box">
        <h2>2. 塔罗牌占卜（无需登录）</h2>
        <div class="input-group">
            <label>问题：</label>
            <input type="text" id="tarot-question" value="我的未来会怎样？" />
        </div>
        <div class="input-group">
            <label>牌阵：</label>
            <select id="tarot-spread">
                <option value="single">单张牌</option>
                <option value="three">三张牌</option>
                <option value="celtic">凯尔特十字</option>
            </select>
        </div>
        <button onclick="testTarot()">测试塔罗牌</button>
        <div id="tarot-result"></div>
    </div>

    <div class="test-box">
        <h2>3. 星座预测（无需登录）</h2>
        <div class="input-group">
            <label>出生日期：</label>
            <input type="date" id="astrology-date" value="1990-01-01" />
        </div>
        <button onclick="testAstrology()">测试星座预测</button>
        <div id="astrology-result"></div>
    </div>

    <div class="test-box">
        <h2>4. 八字算命（无需登录）</h2>
        <div class="input-group">
            <label>出生日期：</label>
            <input type="date" id="bazi-date" value="1990-01-01" />
        </div>
        <div class="input-group">
            <label>出生时间（小时）：</label>
            <input type="number" id="bazi-hour" value="10" min="0" max="23" />
        </div>
        <div class="input-group">
            <label>出生时间（分钟）：</label>
            <input type="number" id="bazi-minute" value="30" min="0" max="59" />
        </div>
        <div class="input-group">
            <label>性别：</label>
            <select id="bazi-gender">
                <option value="male">男</option>
                <option value="female">女</option>
            </select>
        </div>
        <button onclick="testBazi()">测试八字算命</button>
        <div id="bazi-result"></div>
    </div>

    <div class="test-box">
        <h2>5. 周易占卜（无需登录）</h2>
        <div class="input-group">
            <label>问题：</label>
            <input type="text" id="yijing-question" value="我应该如何决策？" />
        </div>
        <div class="input-group">
            <label>方法：</label>
            <select id="yijing-method">
                <option value="coins">铜钱法</option>
                <option value="yarrow">蓍草法</option>
                <option value="numbers">数字法</option>
            </select>
        </div>
        <button onclick="testYijing()">测试周易占卜</button>
        <div id="yijing-result"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';

        function showResult(elementId, status, message, data = null) {
            const element = document.getElementById(elementId);
            let html = `<p><span class="status ${status}">${message}</span></p>`;
            if (data) {
                html += `<pre>${JSON.stringify(data, null, 2)}</pre>`;
            }
            element.innerHTML = html;
        }

        async function testHealth() {
            showResult('health-result', 'pending', '测试中...');
            try {
                const response = await fetch(`${API_URL}/system/health`);
                const data = await response.json();
                if (response.ok) {
                    showResult('health-result', 'success', '✓ 健康检查成功', data);
                } else {
                    showResult('health-result', 'error', '✗ 健康检查失败', data);
                }
            } catch (error) {
                showResult('health-result', 'error', `✗ 错误: ${error.message}`);
            }
        }

        async function testTarot() {
            showResult('tarot-result', 'pending', '测试中...');
            try {
                const question = document.getElementById('tarot-question').value;
                const spreadType = document.getElementById('tarot-spread').value;

                const response = await fetch(`${API_URL}/divination/tarot`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        question,
                        spreadType,
                        name: '测试用户'
                    })
                });

                const data = await response.json();
                if (response.ok && data.success) {
                    showResult('tarot-result', 'success', '✓ 塔罗牌占卜成功', data);
                } else {
                    showResult('tarot-result', 'error', '✗ 塔罗牌占卜失败', data);
                }
            } catch (error) {
                showResult('tarot-result', 'error', `✗ 错误: ${error.message}`);
            }
        }

        async function testAstrology() {
            showResult('astrology-result', 'pending', '测试中...');
            try {
                const birthDate = document.getElementById('astrology-date').value;

                const response = await fetch(`${API_URL}/divination/astrology`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        birthDate,
                        name: '测试用户'
                    })
                });

                const data = await response.json();
                if (response.ok && data.success) {
                    showResult('astrology-result', 'success', '✓ 星座预测成功', data);
                } else {
                    showResult('astrology-result', 'error', '✗ 星座预测失败', data);
                }
            } catch (error) {
                showResult('astrology-result', 'error', `✗ 错误: ${error.message}`);
            }
        }

        async function testBazi() {
            showResult('bazi-result', 'pending', '测试中...');
            try {
                const birthDate = document.getElementById('bazi-date').value;
                const hour = parseInt(document.getElementById('bazi-hour').value);
                const minute = parseInt(document.getElementById('bazi-minute').value);
                const gender = document.getElementById('bazi-gender').value;

                const response = await fetch(`${API_URL}/divination/bazi`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        birthDate,
                        birthTime: { hour, minute },
                        gender,
                        name: '测试用户'
                    })
                });

                const data = await response.json();
                if (response.ok && data.success) {
                    showResult('bazi-result', 'success', '✓ 八字算命成功', data);
                } else {
                    showResult('bazi-result', 'error', '✗ 八字算命失败', data);
                }
            } catch (error) {
                showResult('bazi-result', 'error', `✗ 错误: ${error.message}`);
            }
        }

        async function testYijing() {
            showResult('yijing-result', 'pending', '测试中...');
            try {
                const question = document.getElementById('yijing-question').value;
                const method = document.getElementById('yijing-method').value;

                const response = await fetch(`${API_URL}/divination/yijing`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        question,
                        method
                    })
                });

                const data = await response.json();
                if (response.ok && data.success) {
                    showResult('yijing-result', 'success', '✓ 周易占卜成功', data);
                } else {
                    showResult('yijing-result', 'error', '✗ 周易占卜失败', data);
                }
            } catch (error) {
                showResult('yijing-result', 'error', `✗ 错误: ${error.message}`);
            }
        }

        // 自动测试健康检查
        window.addEventListener('load', () => {
            setTimeout(testHealth, 500);
        });
    </script>
</body>
</html>
